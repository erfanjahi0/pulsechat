<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Settings - PulseChat</title>
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/auth.css">
    <link rel="stylesheet" href="assets/css/profile.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="profile-page">
    <div class="profile-topbar">
        <a href="app.html" class="btn-back-profile">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
            Back to Chat
        </a>
        <h1 class="profile-page-title">Profile Settings</h1>
        <div style="width:120px"></div>
    </div>

    <div class="profile-body">

        <!-- Avatar section -->
        <section class="profile-section">
            <h2 class="section-heading">Profile Photo</h2>
            <div class="avatar-section">
                <div class="avatar avatar-xl" id="profile-avatar">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <div class="avatar-actions">
                    <button class="btn btn-secondary" id="avatar-btn" type="button">Change Photo</button>
                    <input type="file" id="avatar-input" accept="image/*" style="display:none">
                    <p id="avatar-cooldown-info" class="field-hint">You can change your photo once per week.</p>
                </div>
            </div>
        </section>

        <!-- Display name -->
        <section class="profile-section">
            <h2 class="section-heading">Display Name</h2>
            <div id="error-message" class="error-message" role="alert" aria-live="polite"></div>
            <form id="profile-form">
                <div class="form-field">
                    <label for="displayName">Display Name</label>
                    <input type="text" id="displayName" name="displayName" placeholder="Your full name" autocomplete="name" required>
                </div>
                <div class="form-field">
                    <label for="email">Email <span class="field-label-note">(cannot be changed)</span></label>
                    <input type="email" id="email" name="email" disabled>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span class="btn-text">Save Display Name</span>
                    <span class="btn-loading hidden">
                        <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
                            <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
                        </svg>
                    </span>
                </button>
            </form>
        </section>

        <!-- Username -->
        <section class="profile-section">
            <h2 class="section-heading">Username</h2>
            <p class="section-desc">Your unique @handle. People can find you using this. Can be changed once per week.</p>
            <form id="username-form">
                <div class="form-field">
                    <label for="username">Username</label>
                    <div style="position:relative">
                        <span style="position:absolute;left:14px;top:50%;transform:translateY(-50%);color:var(--color-text-tertiary);font-weight:600;pointer-events:none">@</span>
                        <input type="text" id="username" name="username" placeholder="yourhandle"
                            style="padding-left:30px" maxlength="30"
                            pattern="[a-z0-9_]+" autocomplete="off">
                    </div>
                    <span id="username-cooldown-info" class="field-hint">You can change your username once per week.</span>
                </div>
                <button type="submit" class="btn btn-primary">
                    <span class="btn-text">Save Username</span>
                    <span class="btn-loading hidden">
                        <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
                            <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
                        </svg>
                    </span>
                </button>
            </form>
        </section>

        <!-- Appearance -->
        <section class="profile-section">
            <h2 class="section-heading">Appearance</h2>
            <div class="theme-row">
                <div class="theme-info">
                    <span class="theme-label">Theme</span>
                    <span class="theme-value" id="theme-value">Light</span>
                </div>
                <button class="btn btn-secondary" id="theme-toggle-btn" type="button">Toggle Dark Mode</button>
            </div>
        </section>

        <!-- Password change -->
        <section class="profile-section" id="password-section">
            <h2 class="section-heading">Change Password</h2>
            <p class="section-desc">Enter your current password to verify it's you, then set a new one.</p>
            <form id="password-form" autocomplete="off">
                <div class="form-field">
                    <label for="old-password">Current Password</label>
                    <input type="password" id="old-password" name="old-password"
                        placeholder="Your current password" autocomplete="current-password" required>
                </div>
                <div class="form-field">
                    <label for="new-password">New Password</label>
                    <input type="password" id="new-password" name="new-password"
                        placeholder="Min. 6 characters" autocomplete="new-password" required minlength="6">
                </div>
                <div class="form-field">
                    <label for="confirm-new-password">Confirm New Password</label>
                    <input type="password" id="confirm-new-password" name="confirm-new-password"
                        placeholder="Repeat new password" autocomplete="new-password" required minlength="6">
                </div>
                <button type="submit" class="btn btn-primary">
                    <span class="btn-text">Change Password</span>
                    <span class="btn-loading hidden">
                        <svg class="spinner" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10" stroke-opacity="0.25"/>
                            <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round"/>
                        </svg>
                    </span>
                </button>
            </form>
        </section>

        <!-- Danger zone -->
        <section class="profile-section profile-section-danger">
            <h2 class="section-heading">Account</h2>
            <button type="button" class="btn btn-danger" id="logout-btn">Log Out</button>
        </section>
    </div>
</div>

<div id="toast-container" class="toast-container" aria-live="polite"></div>
<script type="module" src="assets/js/profile.js"></script>
<script>
    // Theme toggle on profile page
    const savedTheme = localStorage.getItem('pulsechat-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    const themeValue = document.getElementById('theme-value');
    if (themeValue) themeValue.textContent = savedTheme === 'dark' ? 'Dark' : 'Light';

    document.getElementById('theme-toggle-btn')?.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        localStorage.setItem('pulsechat-theme', next);
        if (themeValue) themeValue.textContent = next === 'dark' ? 'Dark' : 'Light';
    });
</script>
</body>
</html>
